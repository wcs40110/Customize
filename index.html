<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>SVG Text Generator</title>
  <style>
    body {
      font-family: Arial, sans-serif;
      margin: 0;
      padding: 20px;
      background: #f9f9f9;
    }

    .container {
      max-width: 600px;
      margin: auto;
      background: white;
      padding: 20px;
      border-radius: 12px;
      box-shadow: 0 0 10px rgba(0,0,0,0.1);
    }

    label {
      display: block;
      margin-top: 15px;
      font-weight: bold;
    }

    input, textarea, select, button {
      width: 100%;
      padding: 10px;
      margin-top: 5px;
      border: 1px solid #ccc;
      border-radius: 6px;
      font-size: 1em;
    }

    button {
      background-color: #333;
      color: white;
      margin-top: 20px;
      cursor: pointer;
    }

    button:hover {
      background-color: #555;
    }

    #svgPreview {
      margin-top: 20px;
      border: 1px solid #ddd;
      min-height: 150px;
      background: #fff;
      padding: 10px;
    }

    #popupOverlay {
      display: none;
      position: fixed;
      top: 0; left: 0; right: 0; bottom: 0;
      background: rgba(0,0,0,0.6);
      color: white;
      font-size: 1.2em;
      justify-content: center;
      align-items: center;
      z-index: 1000;
    }
  </style>
  <script src="https://cdn.jsdelivr.net/npm/opentype.js@latest/dist/opentype.min.js"></script>
</head>
<body>
<div class="container">
  <h2>SVG Text Generator</h2>
  <form id="customForm" onsubmit="event.preventDefault(); handleSubmit();">
    <label for="customerInput">Customer Name</label>
    <input type="text" id="customerInput" required>

    <label for="descInput">Item Description</label>
    <input type="text" id="descInput" required>

    <label for="locationInput">Engraving Location</label>
    <input type="text" id="locationInput" required>

    <label for="textInput">Text to Engrave</label>
    <textarea id="textInput" rows="2" required></textarea>

    <label for="fontSelector">Font</label>
    <select id="fontSelector">
      <option value="Satisfy">Satisfy</option>
      <option value="Righteous">Righteous</option>
      <option value="Grand Hotel">Grand Hotel</option>
      <option value="Short Stack">Short Stack</option>
      <option value="Love Ya Like A Sister">Love Ya Like A Sister</option>
      <option value="Ribeye Marrow">Ribeye Marrow</option>
    </select>

    <button type="submit">Generate & Download SVG</button>
  </form>

  <div id="svgPreview">SVG preview will appear here...</div>
</div>

<div id="popupOverlay" onclick="this.style.display='none'">SVG Downloaded! Click to dismiss.</div>

<script>
const fontUrls = {
  "Satisfy": "https://tiny-florentine-e8dbd9.netlify.app/satisfy-regular.woff2",
  "Righteous": "https://tiny-florentine-e8dbd9.netlify.app/righteous-v17-latin-regular.woff2",
  "Grand Hotel": "https://tiny-florentine-e8dbd9.netlify.app/grand-hotel-v19-latin-regular.woff2",
  "Short Stack": "https://tiny-florentine-e8dbd9.netlify.app/short-stack-v15-latin-regular.woff2",
  "Love Ya Like A Sister": "https://tiny-florentine-e8dbd9.netlify.app/love-ya-like-a-sister-v22-latin-regular.woff2",
  "Ribeye Marrow": "https://tiny-florentine-e8dbd9.netlify.app/ribeye-marrow-v24-latin-regular.woff2"
};

let loadedFont = null;
let currentFontName = null;

async function loadFont(fontName) {
  if (fontName === currentFontName && loadedFont) return;
  const url = fontUrls[fontName];
  const fontBuffer = await fetch(url).then(res => res.arrayBuffer());
  loadedFont = opentype.parse(fontBuffer);
  currentFontName = fontName;
}

function createSvg(text, font) {
  const fontSize = 80;
  const width = 600;
  const height = 150;
  const path = font.getPath(text, 0, 0, fontSize);
  const pathData = path.toPathData(2);

  return `
    <svg xmlns="http://www.w3.org/2000/svg" width="${width}" height="${height}" viewBox="0 -70 ${width} ${height}">
      <path d="${pathData}" fill="black"/>
    </svg>
  `;
}

async function updatePreview() {
  const text = document.getElementById('textInput').value.trim();
  const fontName = document.getElementById('fontSelector').value;
  if (!text) {
    document.getElementById('svgPreview').innerHTML = "Enter text above to preview.";
    return;
  }

  try {
    await loadFont(fontName);
    const svgMarkup = createSvg(text, loadedFont);
    document.getElementById('svgPreview').innerHTML = svgMarkup;
  } catch (err) {
    console.error("Font loading error", err);
    document.getElementById('svgPreview').textContent = "Error loading font.";
  }
}

async function handleSubmit() {
  const customer = document.getElementById('customerInput').value.trim();
  const desc = document.getElementById('descInput').value.trim();
  const location = document.getElementById('locationInput').value.trim();
  const text = document.getElementById('textInput').value.trim();
  const fontName = document.getElementById('fontSelector').value;

  if (!text) {
    alert("Enter some text to generate SVG.");
    return;
  }

  await loadFont(fontName);
  const svgMarkup = createSvg(text, loadedFont);

  const safeFileName = [customer, desc, location]
    .map(s => s.replace(/\s+/g, "_").replace(/[^\w.-]/g, ''))
    .join("_") + ".svg";

  const blob = new Blob([svgMarkup], { type: "image/svg+xml" });
  const url = URL.createObjectURL(blob);
  const a = document.createElement("a");
  a.href = url;
  a.download = safeFileName;
  document.body.appendChild(a);
  a.click();
  document.body.removeChild(a);
  URL.revokeObjectURL(url);

  document.getElementById('popupOverlay').style.display = 'flex';
}

document.getElementById('textInput').addEventListener('input', updatePreview);
document.getElementById('fontSelector').addEventListener('change', updatePreview);
window.addEventListener('DOMContentLoaded', updatePreview);
</script>
</body>
</html>
