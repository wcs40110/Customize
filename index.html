<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>Custom SVG Text Generator</title>
<style>
  body {
    font-family: Arial, sans-serif;
    margin: 20px;
  }
  label {
    display: block;
    margin: 10px 0 5px;
  }
  input, select, button, textarea {
    padding: 8px;
    width: 100%;
    max-width: 400px;
    box-sizing: border-box;
  }
  #svgPreview {
    margin-top: 20px;
    border: 1px solid #ccc;
    width: 600px;
    height: 150px;
  }
  #popupOverlay {
    position: fixed;
    top: 0; left: 0; right: 0; bottom: 0;
    background: rgba(0,0,0,0.5);
    display: none;
    justify-content: center;
    align-items: center;
    color: white;
    font-size: 1.4em;
    z-index: 1000;
  }
</style>
<script src="https://cdn.jsdelivr.net/npm/opentype.js@latest/dist/opentype.min.js"></script>
</head>
<body>

<h1>Custom SVG Text Generator</h1>

<form id="customForm" onsubmit="event.preventDefault(); handleSubmit();">
  <label for="customerInput">Customer Name *</label>
  <input type="text" id="customerInput" required />

  <label for="descInput">Item Description *</label>
  <input type="text" id="descInput" required />

  <label for="locationInput">Engraving Location *</label>
  <input type="text" id="locationInput" required />

  <label for="textInput">Text to Engrave *</label>
  <textarea id="textInput" rows="2" placeholder="Enter your text here" required></textarea>

  <label for="fontSelector">Choose Font *</label>
  <select id="fontSelector" required>
    <option value="Satisfy">Satisfy</option>
    <option value="Righteous">Righteous</option>
    <option value="Grand Hotel">Grand Hotel</option>
    <option value="Short Stack">Short Stack</option>
    <option value="Love Ya Like A Sister">Love Ya Like A Sister</option>
    <option value="Ribeye Marrow">Ribeye Marrow</option>
  </select>

  <button type="submit" style="margin-top: 15px;">Generate and Download SVG</button>
</form>

<div id="svgPreview">Enter text and select a font to see a preview.</div>

<div id="popupOverlay" onclick="this.style.display='none'">
  SVG file downloaded! Click anywhere to close.
</div>

<script>
  const fontSelectorElement = document.getElementById('fontSelector');
  const textInputElement = document.getElementById('textInput');
  const svgPreviewElement = document.getElementById('svgPreview');

  const fontUrls = {
    "Satisfy": "https://tiny-cactus-4444d4.netlify.app/Satisfy.woff2",
    "Righteous": "https://tiny-cactus-4444d4.netlify.app/Righteous.woff2",
    "Grand Hotel": "https://tiny-cactus-4444d4.netlify.app/GrandHotel.woff2",
    "Short Stack": "https://tiny-cactus-4444d4.netlify.app/ShortStack.woff2",
    "Love Ya Like A Sister": "https://tiny-cactus-4444d4.netlify.app/LoveYaLikeASister.woff2",
    "Ribeye Marrow": "https://tiny-cactus-4444d4.netlify.app/RibeyeMarrow.woff2"
  };

  let loadedFont = null;
  let currentFontName = null;

  async function loadFont(fontName) {
    if (fontName === currentFontName && loadedFont) return;
    const fontUrl = fontUrls[fontName];
    if (!fontUrl) {
      console.error("Font URL not found for:", fontName);
      loadedFont = null;
      currentFontName = null;
      return;
    }
    try {
      loadedFont = await opentype.load(fontUrl);
      currentFontName = fontName;
    } catch (e) {
      console.error("Failed to load font:", e);
      loadedFont = null;
      currentFontName = null;
    }
  }

  function generateSvgPath(text, font, fontSize = 80) {
    if (!font || !text.trim()) return '';

    let x = 0;
    const y = fontSize;

    const path = font.getPath(text, x, y, fontSize);

    return path.toPathData(2);
  }

  function generateSvgContentWithPaths(text, fontName) {
    if (!text.trim()) {
      return 'Enter text and select a font to see a preview.';
    }
    if (!loadedFont) {
      return 'Loading font...';
    }

    const fontSize = 80;
    const svgWidth = 600;
    const svgHeight = 150;

    const pathData = generateSvgPath(text, loadedFont, fontSize);
    const textWidth = loadedFont.getAdvanceWidth(text, fontSize);

    const translateX = (svgWidth - textWidth) / 2;
    const translateY = (svgHeight / 2) + (fontSize / 3);

    return `
      <svg xmlns="http://www.w3.org/2000/svg" width="${svgWidth}" height="${svgHeight}" viewBox="0 0 ${svgWidth} ${svgHeight}">
        <g transform="translate(${translateX}, ${translateY})">
          <path d="${pathData}" fill="#333" />
        </g>
      </svg>
    `;
  }

  async function updatePreview() {
    const text = textInputElement.value;
    const fontName = fontSelectorElement.value;

    if (fontName !== currentFontName || !loadedFont) {
      await loadFont(fontName);
    }

    svgPreviewElement.innerHTML = generateSvgContentWithPaths(text, fontName);
  }

  async function handleSubmit() {
    const customerName = document.getElementById('customerInput').value.trim();
    const itemDescription = document.getElementById('descInput').value.trim();
    const engravingLocation = document.getElementById('locationInput').value.trim();
    const text = textInputElement.value.trim();
    const fontName = fontSelectorElement.value;

    if (!customerName || !itemDescription || !engravingLocation || !text) {
      alert("Please fill out all required fields before submitting.");
      return;
    }

    if (fontName !== currentFontName || !loadedFont) {
      await loadFont(fontName);
    }

    const filenameSafe = (str) => str.replace(/\s+/g, '_').replace(/[^\w.-]/g, '');
    const filename = `${filenameSafe(customerName)}_${filenameSafe(itemDescription)}_${filenameSafe(engravingLocation)}.svg`;

    const svgContent = generateSvgContentWithPaths(text, fontName);
    const blob = new Blob([svgContent], { type: 'image/svg+xml;charset=utf-8' });
    const url = URL.createObjectURL(blob);

    const a = document.createElement('a');
    a.href = url;
    a.download = filename;
    document.body.appendChild(a);
    a.click();
    document.body.removeChild(a);
    URL.revokeObjectURL(url);

    document.getElementById('popupOverlay').style.display = 'flex';
  }

  textInputElement.addEventListener('input', updatePreview);
  fontSelectorElement.addEventListener('change', updatePreview);

  // Load initial font and preview
  window.addEventListener('DOMContentLoaded', updatePreview);
</script>

</body>
</html>
